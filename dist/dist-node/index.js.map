{"version":3,"file":"index.js","sources":["../dist-src/setHeaders.js","../dist-src/vercelApollo.js","../dist-src/ApolloServer.js"],"sourcesContent":["export const setHeaders = (res, headers) => {\n  for (const [name, value] of Object.entries(headers)) {\n    res.setHeader(name, value);\n  }\n};","import { runHttpQuery, convertNodeHttpToRequest } from \"apollo-server-core\";\nimport { setHeaders } from \"./setHeaders.js\";\nexport function graphqlVercel(options) {\n  if (!options) throw new Error(`Apollo Server requires options.`);\n\n  if (arguments.length > 1) {\n    throw new Error(`Apollo Server expects exactly one argument, got ${arguments.length}`);\n  }\n\n  const graphqlHandler = async (req, res) => {\n    try {\n      const {\n        graphqlResponse,\n        responseInit\n      } = await runHttpQuery([req, res], {\n        method: req.method,\n        options,\n        query: req.method === `POST` ? req.body : req.query,\n        request: convertNodeHttpToRequest(req)\n      });\n      setHeaders(res, responseInit.headers ?? {});\n      res.statusCode = 200;\n      res.send(graphqlResponse);\n    } catch (error) {\n      const err = error;\n      if (err.headers) setHeaders(res, err.headers);\n      res.statusCode = err.statusCode;\n      res.send(err.message);\n    }\n  };\n\n  return graphqlHandler;\n}","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { ApolloServerBase } from \"apollo-server-core\";\nimport { renderPlaygroundPage } from \"@apollographql/graphql-playground-html\";\nimport { Headers } from \"fetch-headers\";\nimport { graphqlVercel } from \"./vercelApollo.js\";\nimport { setHeaders } from \"./setHeaders.js\";\nexport class ApolloServer extends ApolloServerBase {\n  createGraphQLServerOptions(req, res) {\n    return super.graphQLServerOptions({\n      req,\n      res\n    });\n  }\n\n  createHandler({\n    cors,\n    onHealthCheck\n  } = {}) {\n    const corsHeaders = new Headers();\n\n    if (cors) {\n      if (cors.methods) {\n        if (typeof cors.methods === `string`) {\n          corsHeaders.set(`access-control-allow-methods`, cors.methods);\n        } else if (Array.isArray(cors.methods)) {\n          corsHeaders.set(`access-control-allow-methods`, cors.methods.join(`,`));\n        }\n      }\n\n      if (cors.allowedHeaders) {\n        if (typeof cors.allowedHeaders === `string`) {\n          corsHeaders.set(`access-control-allow-headers`, cors.allowedHeaders);\n        } else if (Array.isArray(cors.allowedHeaders)) {\n          corsHeaders.set(`access-control-allow-headers`, cors.allowedHeaders.join(`,`));\n        }\n      }\n\n      if (cors.exposedHeaders) {\n        if (typeof cors.exposedHeaders === `string`) {\n          corsHeaders.set(`access-control-expose-headers`, cors.exposedHeaders);\n        } else if (Array.isArray(cors.exposedHeaders)) {\n          corsHeaders.set(`access-control-expose-headers`, cors.exposedHeaders.join(`,`));\n        }\n      }\n\n      if (cors.credentials) {\n        corsHeaders.set(`access-control-allow-credentials`, `true`);\n      }\n\n      if (typeof cors.maxAge === `number`) {\n        corsHeaders.set(`access-control-max-age`, cors.maxAge.toString());\n      }\n    }\n\n    return async (req, res) => {\n      const requestCorsHeaders = new Headers(corsHeaders);\n\n      if (cors && cors.origin) {\n        const requestOrigin = req.headers.origin;\n\n        if (typeof cors.origin === `string`) {\n          requestCorsHeaders.set(`access-control-allow-origin`, cors.origin);\n        } else if (requestOrigin && (typeof cors.origin === `boolean` || Array.isArray(cors.origin) && requestOrigin && cors.origin.includes(requestOrigin))) {\n          requestCorsHeaders.set(`access-control-allow-origin`, requestOrigin);\n        }\n\n        const requestAccessControlRequestHeaders = req.headers[`access-control-request-headers`];\n\n        if (!cors.allowedHeaders && requestAccessControlRequestHeaders) {\n          requestCorsHeaders.set(`access-control-allow-headers`, requestAccessControlRequestHeaders);\n        }\n      }\n\n      const requestCorsHeadersObject = Object.fromEntries(requestCorsHeaders.entries());\n\n      if (req.method === `OPTIONS`) {\n        setHeaders(res, requestCorsHeadersObject);\n        res.statusCode = 204;\n        res.send(``);\n      }\n\n      if (req.url === `/.well-known/apollo/server-health`) {\n        const successfulResponse = () => {\n          setHeaders(res, _objectSpread({\n            \"Content-Type\": `application/json`\n          }, requestCorsHeadersObject));\n          res.statusCode = 200;\n          res.send({\n            status: `pass`\n          });\n        };\n\n        if (onHealthCheck) {\n          try {\n            await onHealthCheck(req);\n            successfulResponse();\n          } catch {\n            setHeaders(res, _objectSpread({\n              \"Content-Type\": `application/json`\n            }, requestCorsHeadersObject));\n            res.statusCode = 503;\n            res.send({\n              status: `fail`\n            });\n          }\n        } else {\n          successfulResponse();\n        }\n      }\n\n      if (this.playgroundOptions && req.method === `GET`) {\n        const acceptHeader = req.headers.Accept || req.headers.accept;\n\n        if (acceptHeader && acceptHeader.includes(`text/html`)) {\n          const path = req.url || `/`;\n\n          const playgroundRenderPageOptions = _objectSpread({\n            endpoint: path\n          }, this.playgroundOptions);\n\n          setHeaders(res, _objectSpread({\n            \"Content-Type\": `text/html`\n          }, requestCorsHeadersObject));\n          res.statusCode = 200;\n          res.send(renderPlaygroundPage(playgroundRenderPageOptions));\n        }\n      }\n\n      graphqlVercel(() => this.createGraphQLServerOptions(req, res));\n    };\n  }\n\n}"],"names":["setHeaders","res","headers","name","value","Object","entries","setHeader","graphqlVercel","options","Error","arguments","length","graphqlHandler","req","graphqlResponse","responseInit","runHttpQuery","method","query","body","request","convertNodeHttpToRequest","statusCode","send","error","err","message","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","configurable","writable","ApolloServer","ApolloServerBase","createGraphQLServerOptions","graphQLServerOptions","createHandler","cors","onHealthCheck","corsHeaders","Headers","methods","set","Array","isArray","join","allowedHeaders","exposedHeaders","credentials","maxAge","toString","requestCorsHeaders","origin","requestOrigin","includes","requestAccessControlRequestHeaders","requestCorsHeadersObject","fromEntries","url","successfulResponse","status","playgroundOptions","acceptHeader","Accept","accept","path","playgroundRenderPageOptions","endpoint","renderPlaygroundPage"],"mappings":"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"}